octoprint:
  host: !secret octoprint_host
  api_key: !secret octoprint_api_key
  name: Droopy
  number_of_tools: 1
  bed: true
  sensors:
    monitored_conditions:
      - 'Current State'
      - 'Temperatures'      
      - 'Job Percentage'
      - 'Time Elapsed'
      - 'Time Remaining'
  binary_sensors:
    monitored_conditions:
      - 'Printing'
      - 'Printing Error'

shell_command:
  shutdown_octoprint: !secret octoprint_shutdown_ssh

# This input boolean should not be added to the UI and it's set to true via a
# script when droopy is shutting down
input_boolean:
  droopy_shutting_down:
    name: Droopy Shutting Down
    initial: false

# This sensor display the 3 status of droopy. On, Off and Shutting down.
sensor:
  - platform: template
    sensors:
      droopy_power_status:
        friendly_name: "Droopy Power"
        icon_template: >-
          {% if is_state('input_boolean.droopy_shutting_down', 'on') %}
            mdi:power-plug-outline
          {% elif is_state('switch.droopy', 'on') %}
            mdi:power-plug
          {% else %}
            mdi:power-plug-off-outline
          {% endif %}
        value_template: >-
          {% if is_state('input_boolean.droopy_shutting_down', 'on') %}
            Shutting down...
          {% elif is_state('switch.droopy', 'on') %}
            On
          {% else %}
            Off
          {% endif %}
      droopy_elapsed_pretty:
        friendly_name: "Time Elapsed"
        icon_template: mdi:clock-start
        value_template: >-
          {% set time = states.sensor.droopy_time_elapsed.state | int %}
          {% set seconds = (time % 60) | int %}
          {% set minutes = ((time % 3600) / 60) | int %}
          {% set hours = ((time % 86400) / 3600) | int %}
          {% set days = (time / 86400) | int %}
          {%- if days > 0 -%}
            {{ days }} days, {{ hours }} hours, {{ minutes }} minutes, {{ seconds }} seconds
          {%- elif hours > 0 -%}
            {{ hours }} hours, {{ minutes }} minutes, {{ seconds }} seconds
          {%- elif minutes > 0 -%}
            {{ minutes }} minutes, {{ seconds }} seconds
          {%- else -%}
            {{ seconds }} seconds
          {%- endif -%}
      droopy_remaining_pretty:
        friendly_name: "Time Remaining"
        icon_template: mdi:clock-end
        value_template: >-
          {% set time = states.sensor.droopy_time_remaining.state | int %}
          {% set seconds = (time % 60) | int %}
          {% set minutes = ((time % 3600) / 60) | int %}
          {% set hours = ((time % 86400) / 3600) | int %}
          {% set days = (time / 86400) | int %}
          {%- if days > 0 -%}
            {{ days }} days, {{ hours }} hours, {{ minutes }} minutes, {{ seconds }} seconds
          {%- elif hours > 0 -%}
            {{ hours }} hours, {{ minutes }} minutes, {{ seconds }} seconds
          {%- elif minutes > 0 -%}
            {{ minutes }} minutes, {{ seconds }} seconds
          {%- else -%}
            {{ seconds }} seconds
          {%- endif -%}
  - platform: command_line
    name: OctoPi CPU Temperature
    command: !secret octoprint_cpu_temp_ssh
    unit_of_measurement: "ÂºC"
    value_template: '{{ value | multiply(0.001) }}'

camera:
  - platform: mjpeg
    name: Droopy Cam
    still_image_url: !secret octoprint_url_webcam_snapshot
    mjpeg_url: !secret octoprint_url_webcam_stream

automation: !include_dir_merge_list automations/
script: !include_dir_merge_named scripts/