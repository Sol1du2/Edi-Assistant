- id: send_droopy_current_status_telegram
  alias: Send the current status of droopy
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/droopy_status'
  action:
    - service: telegram_bot.send_message
      data_template:
        target: "{{ trigger.event.data.chat_id }}"
        message: |
          *State:* {{ states.sensor.droopy_current_state.state }}
          *Job Percentage:* {{ states.sensor.droopy_job_percentage.state }}%
          *Remaining Time:* {{ states.sensor.droopy_remaining_pretty.state }}
          *Elapsed Time:* {{ states.sensor.droopy_elapsed_pretty.state }}

          *Tool Temp:* {{ states.sensor.droopy_actual_tool0_temp.state }}째C
          *Bed Temp:* {{ states.sensor.droopy_actual_bed_temp.state }}째C
          *Target Tool Temp:* {{ states.sensor.droopy_target_tool0_temp.state }}째C
          *Target Bed Temp:* {{ states.sensor.droopy_target_bed_temp.state }}째C

- id: send_droopy_snapshot_telegram
  alias: Send a snapshot of droopy's camera
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/droopy_snap'
  action:
    - service: telegram_bot.send_photo
      data:
        target: "{{ trigger.event.data.chat_id }}"
        caption: 'Droopy''s snapshot!'
        url: !secret octoprint_url_webcam

- id: turn_off_droopy_telegram
  alias: Turn off droopy with telegram
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/droopy_off'
  action:
    - service: script.turn_on
      entity_id: script.safely_power_off_droopy
    - service: telegram_bot.send_message
      data:
        target: "{{ trigger.event.data.chat_id }}"
        message: 'Droopy shutdown initiated!'

- id: emergency_droopy_telegram
  alias: Emergency shutdown droopy with telegram
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/droopy_emergency'
  action:
    - service: light.turn_off
      data:
        entity_id: switch.droopy